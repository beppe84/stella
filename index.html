<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Beppe & Stella</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
</head>
<body>

    <div id="countdown-content" class="full-screen-content"> 
        <h1>Meeting in Malmö in</h1>
        
        <p id="status-message"></p>
        
        <div class="digital-countdown">
            
            <div class="time-group">
                <span id="days-number" class="number">00</span>
                <span class="label">Days</span>
            </div>
            
            <div id="heart-3" class="heart-separator">
                <svg viewBox="0 0 100 100" class="heart-svg">
                    <path d="M50,90 C-10,40 10,0 50,20 C90,0 110,40 50,90 Z" fill="#ff69b4"/> 
                </svg>
            </div>
            
            <div class="time-group">
                <span id="hours-number" class="number">00</span>
                <span class="label">Hours</span>
            </div>
            
            <div id="heart-1" class="heart-separator">
                <svg viewBox="0 0 100 100" class="heart-svg">
                    <path d="M50,90 C-10,40 10,0 50,20 C90,0 110,40 50,90 Z" fill="#61dafb"/>
                </svg>
            </div>
            
            <div class="time-group">
                <span id="minutes-number" class="number">00</span>
                <span class="label">Minutes</span>
            </div>
            
            <div id="heart-2" class="heart-separator">
                <svg viewBox="0 0 100 100" class="heart-svg">
                    <path d="M50,90 C-10,40 10,0 50,20 C90,0 110,40 50,90 Z" fill="#ff69b4"/>
                </svg>
            </div>
            
            <div class="time-group">
                <span id="seconds-number" class="number">00</span>
                <span class="label">Seconds</span>
            </div>
            
        </div>
        
    </div>

    <div id="neon-final-screen" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; align-items: center; justify-content: center; background-color: #000;">
        
         <div id="heart-rain-container"></div> 
        <div id="container-neon">
            <div id="txt-blur">Journeys end<br>in lovers meeting</div>
            <div id="txt">Journeys end<br>in lovers meeting</div>
            <span id="gradient"></span>
            <span id="light"></span>
        </div>
    </div>


    <script>
    let countdownInterval;
    // TARGET_DATE_STRING è mantenuta
    const TARGET_DATE_STRING = "2025-11-28 09:30:00"; 
    const countDownDateMs = new Date(TARGET_DATE_STRING).getTime(); 
    
    const heart1 = document.getElementById("heart-1");
    const heart2 = document.getElementById("heart-2");
    const heart3 = document.getElementById("heart-3"); 
    
    // Rinomino fullScreenContent in countdownContent per chiarezza
    const countdownContent = document.getElementById("countdown-content");
    const neonFinalScreen = document.getElementById("neon-final-screen");
    const heartRainContainer = document.getElementById("heart-rain-container"); // NUOVA VARIABILE
    
    // Variabile per tracciare lo stato
    let countdownFinished = false; 
    let heartRainInterval; // NUOVA VARIABILE

    /**
     * Riavvia l'animazione forzando il ricalcolo CSS, sincronizzando il battito.
     */
    function restartHeartAnimation() {
        const hearts = [heart1, heart2, heart3]; 
        hearts.forEach(heart => {
            heart.classList.remove("heart-animated");
            void heart.offsetWidth; 
            heart.classList.add("heart-animated");
        });
    }

    /**
     * NUOVA FUNZIONE: Genera un singolo cuore, lo anima e lo rimuove.
     */
    function createHeart() {
        const heart = document.createElement('div');
        heart.classList.add('rain-heart');
        
        // imposta opacità casuale
        const opacity = Math.random() * 0.4 + 1;

        // Colore casuale tra rosa (#ff69b4) e azzurro (#61dafb)
        const colors = ["#ff69b4", "#61dafb"];
        const color = colors[Math.floor(Math.random() * colors.length)];
        
        // Dimensione casuale
        const size = Math.random() * 60 + 30; // tra 15px e 25px
        
        // Posizionamento orizzontale casuale
        const startPosition = Math.random() * 100; // tra 0% e 100%
        
        // Animazione e durata casuale per un effetto più naturale
        const duration = Math.random() * 3 + 4; // tra 4s e 7s
        const delay = Math.random() * 1.5; // fino a 2s di ritardo

        // Stile del cuore SVG
        heart.innerHTML = `
            <svg viewBox="0 0 100 100" style="fill: ${color}; width: ${size}px; height: ${size}px;">
                <path d="M50,90 C-10,40 10,0 50,20 C90,0 110,40 50,90 Z"/> 
            </svg>
        `;
        
        heart.style.left = `${startPosition}vw`;
        heart.style.opacity = opacity;
        heart.style.animationDuration = `${duration}s`;
        heart.style.animationDelay = `${delay}s`;
        
        heartRainContainer.appendChild(heart);

        // Rimuove il cuore dopo che l'animazione è finita
        heart.addEventListener('animationend', () => {
            heart.remove();
        });
    }
    
    /**
     * NUOVA FUNZIONE: Inizia la generazione continua della pioggia di cuori.
     */
    function startHeartRain() {
        if (heartRainInterval) clearInterval(heartRainInterval);
        
        // Genera un cuore ogni 200ms
        heartRainInterval = setInterval(createHeart, 100); 
    }
    
    /**
     * NUOVA FUNZIONE: Ferma la generazione della pioggia di cuori.
     */
    function stopHeartRain() {
        if (heartRainInterval) clearInterval(heartRainInterval);
    }


    function showNeonAnimation() {
        countdownContent.style.display = 'none'; // Nasconde il countdown
        neonFinalScreen.style.display = 'grid'; // Mostra l'animazione neon (display: grid per centratura)
        startHeartRain(); // Avvia la pioggia di cuori
    }

    function startCountdown() {
        if (countdownInterval) {
            clearInterval(countdownInterval);
        }
        
        countdownContent.style.display = 'flex';
        neonFinalScreen.style.display = 'none'; 
        
        stopHeartRain(); // Assicura che la pioggia sia ferma
        
        document.getElementById("status-message").innerHTML = ""; 

        restartHeartAnimation(); 

        countdownInterval = setInterval(function() {

            const now = new Date().getTime();
            let distance = countDownDateMs - now;

            if (distance <= 0) {
                // Se il countdown è finito e non abbiamo ancora mostrato l'animazione
                if (!countdownFinished) {
                    clearInterval(countdownInterval); // Ferma il timer
                    showNeonAnimation(); // Mostra l'animazione finale
                    countdownFinished = true;
                    return; 
                }
                distance = 0; 
            } 
            
            // Logica di calcolo del tempo
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const millisecondsLeftAfterDays = distance % (1000 * 60 * 60 * 24);
            const totalHours = Math.floor(millisecondsLeftAfterDays / (1000 * 60 * 60));
            const millisecondsLeftAfterHours = distance % (1000 * 60 * 60);
            const minutes = Math.floor(millisecondsLeftAfterHours / (1000 * 60));
            const millisecondsLeftAfterMinutes = distance % (1000 * 60);
            const seconds = Math.floor(millisecondsLeftAfterMinutes / 1000);
            
            const daysDisplay = days < 10 ? "0" + days : days;
            const hoursDisplay = totalHours < 10 ? "0" + totalHours : totalHours;
            const minutesDisplay = minutes < 10 ? "0" + minutes : minutes;
            const secondsDisplay = seconds < 10 ? "0" + seconds : seconds;
            
            document.getElementById("days-number").innerHTML = daysDisplay;
            document.getElementById("hours-number").innerHTML = hoursDisplay;
            document.getElementById("minutes-number").innerHTML = minutesDisplay;
            document.getElementById("seconds-number").innerHTML = secondsDisplay;
            
            restartHeartAnimation();

        }, 1000); 
    }

    window.onload = startCountdown; 
    </script>

</body>
</html>
